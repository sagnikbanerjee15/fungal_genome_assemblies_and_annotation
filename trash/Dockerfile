###################################################################################################################################################################################################
# Fungal genome assembly and annotation 
###################################################################################################################################################################################################

FROM ndsuccast/singularity:3.8.0
MAINTAINER Sagnik Banerjee <sagnikbanerjee15@gmail.com>

ENV TZ=America/New_York
ENV DEBIAN_FRONTEND=noninteractive

###################################################################################################################################################################################################
# Update base image and install software
###################################################################################################################################################################################################

RUN apt-get -y update
RUN apt-get -y install git python3.7 less vim wget time zlib1g zlib1g-dev lzma-dev \
	libncurses5-dev libcurl4-nss-dev liblzma-dev libncursesw5-dev make unzip zip build-essential \
	gcc g++ cmake ca-certificates libbz2-dev xz-utils htop autoconf automake binutils bison flex \
	gettext libtool make patch pkg-config p7zip-full p7zip python r-base curl sudo
RUN apt-get clean all

###################################################################################################################################################################################################
# RepeatMasker
###################################################################################################################################################################################################

RUN singularity pull dfam-tetools-latest.sif docker://dfam/tetools:latest

###################################################################################################################################################################################################
# Create directories for installation
###################################################################################################################################################################################################

RUN mkdir /software 
ENV PATH=$PATH:/software

###################################################################################################################################################################################################
# CONDA
###################################################################################################################################################################################################

RUN rm -rf /var/lib/apt/lists/*
ENV CONDA_DIR /opt/conda
RUN wget --quiet https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh && \
     /bin/bash ~/miniconda.sh -b -p /opt/conda

# Put conda in path so we can use conda activate
ENV PATH=$PATH:$CONDA_DIR/bin

###################################################################################################################################################################################################
# SAMTOOLS
###################################################################################################################################################################################################

ARG SAMTOOLS_VERSION=1.15
RUN cd /software && wget https://github.com/samtools/samtools/releases/download/1.15/samtools-${SAMTOOLS_VERSION=1.15}.tar.bz2 && \
	tar xjvf samtools-${SAMTOOLS_VERSION=1.15}.tar.bz2 && \
	mv samtools-1.15 samtools_dir && \
	cd samtools_dir && \
	./configure --prefix=/software/samtools_dir && \
	make && \
	make install && \
	mv /software/samtools_dir/samtools /software && \
	cd /software && \
	rm -rf samtools-${SAMTOOLS_VERSION=1.15}.tar.bz2 && \
	rm -rf samtools_dir
	
###################################################################################################################################################################################################
# STAR
###################################################################################################################################################################################################

RUN conda install -c bioconda star -y

###################################################################################################################################################################################################
# ABYSS
###################################################################################################################################################################################################

RUN conda install -c bioconda abyss -y

###################################################################################################################################################################################################
# BLASR
###################################################################################################################################################################################################

RUN conda install -c bioconda blasr -y
    
###################################################################################################################################################################################################
# MASURCA
###################################################################################################################################################################################################

ARG MASURCA_VERSION=4.0.8
RUN apt-get update
RUN apt-get install libboost-all-dev -y
RUN cd /software && wget https://github.com/alekseyzimin/masurca/releases/download/v4.0.8/MaSuRCA-${MASURCA_VERSION}.tar.gz && \
	tar -xvzf MaSuRCA-${MASURCA_VERSION}.tar.gz && \
	mv MaSuRCA-${MASURCA_VERSION} masurca && \
	cd masurca && \
	sed -i '24s/make\ &&\ cp\ -a\ ..\/Flye\ $DEST/make/' install.sh && \
	./install.sh && \
	cd /software && \
	rm -rf MaSuRCA-${MASURCA_VERSION}.tar.gz
	
ENV PATH=$PATH:/software/masurca/bin

###################################################################################################################################################################################################
# Soapdenovo2
###################################################################################################################################################################################################

RUN conda install -c bioconda soapdenovo2 -y

###################################################################################################################################################################################################
# Spades
###################################################################################################################################################################################################

RUN conda install -c bioconda spades -y

###################################################################################################################################################################################################
# Velvet
###################################################################################################################################################################################################

RUN conda install -c bioconda velvet -y

###################################################################################################################################################################################################
# FGMP
###################################################################################################################################################################################################

RUN conda install -c bioconda fgmp -y

###################################################################################################################################################################################################
# Rascaf
###################################################################################################################################################################################################

RUN cd /software && git clone https://github.com/mourisl/rascaf.git && \
	cd rascaf && \
	make 
	
ENV PATH=$PATH:/software/rascaf

###################################################################################################################################################################################################
# P_RNA_scaffolder
###################################################################################################################################################################################################

RUN cd /software && git clone https://github.com/CAFS-bioinformatics/P_RNA_scaffolder.git && cd P_RNA_scaffolder && chmod a+x *

ENV PATH=$PATH:/software/P_RNA_scaffolder

###################################################################################################################################################################################################
# AGOUTI
###################################################################################################################################################################################################

RUN cd /software && git clone https://github.com/svm-zhang/AGOUTI.git && \
	cd AGOUTI
	
ENV PATH=$PATH:/software/AGOUTI

###################################################################################################################################################################################################
# Ruffus
###################################################################################################################################################################################################

RUN conda install -c bioconda ruffus

###################################################################################################################################################################################################
# gffread
###################################################################################################################################################################################################

RUN conda install -c bioconda gffread

###################################################################################################################################################################################################
# Effectorp
###################################################################################################################################################################################################

RUN conda install -c predector effectorp2

RUN conda install -c predector effectorp3

###################################################################################################################################################################################################
# BLAST
###################################################################################################################################################################################################

RUN conda install -c bioconda blast

###################################################################################################################################################################################################
# tRNAScan-SE (for spliceosomal RNA genes, microRNAs and other types of small RNAs)
###################################################################################################################################################################################################

RUN conda install -c bioconda trnascan-se

###################################################################################################################################################################################################
# Infernal
###################################################################################################################################################################################################

RUN conda install -c bioconda infernal

# Other Softwares to install - salmon, DESeq2, Effector-p, Signalp, TargetP




	